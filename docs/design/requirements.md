  COMPLETE REQUIREMENTS LIST - ELSPETH Architecture

  1. CONFIGURATION REQUIREMENTS

1.1 Configuration Format (from README.md lines 73-113, architecture.md lines 832-891)
  ┌────────────────┬──────────────────────────────────────────────────────────────┬────────────────────────────────────────────┬─────────────────────────────────────────┐
  │ Requirement ID │                         Requirement                          │                   Source                   │                 Status                  │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-001        │ Config uses datasource key (not source)                      │ README.md:75                               │ ❌ DIVERGED - CLI uses source           │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-002        │ datasource.plugin specifies the source plugin name           │ README.md:76                               │ ❌ DIVERGED - CLI expects source.plugin │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-003        │ datasource.options holds plugin-specific config              │ README.md:77-78                            │ ❌ DIVERGED                             │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-004        │ sinks is a dict of named sinks                               │ README.md:80-89                            │ ✅ Implemented                          │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-005        │ Each sink has plugin and options keys                        │ README.md:81-88                            │ ✅ Implemented                          │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-006        │ row_plugins is an array of transforms                        │ README.md:91-99, architecture.md:858       │ ❌ DIVERGED - CLI calls it transforms   │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-007        │ Each row_plugin has plugin, type, options, routes            │ README.md:92-99                            │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-008        │ output_sink specifies the default sink                       │ README.md:107                              │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-009        │ landscape.enabled boolean flag                               │ README.md:109-110                          │ ❌ DIVERGED                             │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-010        │ landscape.backend specifies storage type (sqlite/postgresql) │ README.md:111, architecture.md:883         │ ❌ DIVERGED - CLI expects landscape.url │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-011        │ landscape.path specifies database path                       │ README.md:112                              │ ❌ DIVERGED - CLI expects landscape.url │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-012        │ landscape.retention.row_payloads_days config                 │ architecture.md:556-559, 886               │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-013        │ landscape.retention.call_payloads_days config                │ architecture.md:556-559, 887               │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-014        │ landscape.redaction.profile config                           │ architecture.md:889-890                    │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-015        │ concurrency.max_workers config (default 4, production 16)    │ README.md:195-202                          │ ❌ NOT IMPLEMENTED                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-016        │ Profile system with profiles: key and --profile flag         │ README.md:199-209                          │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-017        │ Environment variable interpolation ${VAR}                    │ README.md:213-216                          │ Partial - via Dynaconf                  │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-018        │ Hierarchical settings merge with clear precedence            │ README.md:188-206, architecture.md:820-828 │ ❌ Partially implemented                │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-019        │ Pack defaults (packs/llm/defaults.yaml)                      │ architecture.md:824, CLAUDE.md             │ ❌ Not implemented                      │
  ├────────────────┼──────────────────────────────────────────────────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┤
  │ CFG-020        │ Suite configuration (suite.yaml)                             │ architecture.md:823                        │ ❌ Not implemented                      │
  └────────────────┴──────────────────────────────────────────────────────────────┴────────────────────────────────────────────┴─────────────────────────────────────────┘
  1.2 Configuration Settings Classes (from architecture and Phase 1 plan)
  ┌────────────────┬────────────────────────────────────────────────────┬────────────────────────────────────┬────────────────────────────────────────────────┐
  │ Requirement ID │                    Requirement                     │               Source               │                     Status                     │
  ├────────────────┼────────────────────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────────────────┤
  │ CFG-021        │ LandscapeSettings class                            │ Phase 1 plan                       │ ❌ NOT IMPLEMENTED - using different structure │
  ├────────────────┼────────────────────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────────────────┤
  │ CFG-022        │ RetentionSettings class                            │ Phase 1 plan                       │ ❌ NOT IMPLEMENTED                             │
  ├────────────────┼────────────────────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────────────────┤
  │ CFG-023        │ ConcurrencySettings class                          │ Phase 1 plan                       │ ❌ NOT IMPLEMENTED                             │
  ├────────────────┼────────────────────────────────────────────────────┼────────────────────────────────────┼────────────────────────────────────────────────┤
  │ CFG-024        │ Settings stored with run (resolved, not just hash) │ architecture.md:270, subsystems:97 │ ✅ Implemented in runs table                   │
  └────────────────┴────────────────────────────────────────────────────┴────────────────────────────────────┴────────────────────────────────────────────────┘
  ---

  1. CLI REQUIREMENTS

2.1 CLI Commands (from README.md, architecture.md, CLAUDE.md)
  ┌────────────────┬───────────────────────────────────────────────────────────────┬──────────────────────────────┬──────────────────────────────────┐
  │ Requirement ID │                          Requirement                          │            Source            │              Status              │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-001        │ elspeth --settings <file> to run pipeline                     │ README.md:116                │ ✅ Implemented as elspeth run -s │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-002        │ elspeth --profile <name> for profile selection                │ README.md:208                │ ❌ Not implemented               │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-003        │ elspeth explain --run <id> --row <id>                         │ README.md:122-136, CLAUDE.md │ ✅ Implemented                   │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-004        │ elspeth explain with --full flag for auditor view             │ architecture.md:765-766      │ ❌ Not implemented               │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-005        │ elspeth validate --settings <file>                            │ CLAUDE.md                    │ ✅ Implemented                   │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-006        │ elspeth plugins list                                          │ CLAUDE.md                    │ ✅ Implemented                   │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-007        │ elspeth status to check run status                            │ subsystems/00-overview:736   │ ❌ Not implemented               │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-008        │ Human-readable output by default, --json for machine-readable │ subsystems/00-overview:739   │ ✅ Partial                       │
  ├────────────────┼───────────────────────────────────────────────────────────────┼──────────────────────────────┼──────────────────────────────────┤
  │ CLI-009        │ TUI mode using Textual                                        │ architecture.md:777          │ ✅ Implemented basic             │
  └────────────────┴───────────────────────────────────────────────────────────────┴──────────────────────────────┴──────────────────────────────────┘
  ---

  1. SDA MODEL REQUIREMENTS

3.1 Sources (from architecture.md, subsystems/00-overview)
  ┌────────────────┬─────────────────────────────────────┬───────────────────────────┬──────────────────────────────┐
  │ Requirement ID │             Requirement             │          Source           │            Status            │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-001        │ Exactly one source per run          │ CLAUDE.md, subsystems:303 │ ✅ Implemented               │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-002        │ Sources are stateless               │ architecture.md:103       │ ✅ Implemented               │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-003        │ CSV source plugin                   │ CLAUDE.md                 │ ✅ Implemented               │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-004        │ JSON/JSONL source plugin            │ CLAUDE.md                 │ ✅ Implemented               │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-005        │ Database source plugin              │ README.md:172             │ ❌ Not implemented           │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-006        │ HTTP API source plugin              │ README.md:172             │ ❌ Not implemented (Phase 6) │
  ├────────────────┼─────────────────────────────────────┼───────────────────────────┼──────────────────────────────┤
  │ SDA-007        │ Message queue source (blob storage) │ README.md:172             │ ❌ Not implemented           │
  └────────────────┴─────────────────────────────────────┴───────────────────────────┴──────────────────────────────┘
  3.2 Transforms (from plugin-protocol.md - Plugins touch row contents)
  ┌────────────────┬─────────────────────────────────────────────┬──────────────────────────────────────────┬───────────────────────────────────────┐
  │ Requirement ID │                 Requirement                 │                  Source                  │                Status                 │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-008        │ Zero or more transforms, ordered            │ plugin-protocol.md                       │ ✅ Implemented                        │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-009        │ Transforms stateless between rows           │ plugin-protocol.md:328                   │ ✅ Protocol defined                   │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-010        │ Transform: 1 row in → 1 row out             │ plugin-protocol.md:330                   │ ✅ Implemented                        │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-011        │ Transform process() returns TransformResult │ plugin-protocol.md:384-398               │ ✅ Implemented                        │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-012        │ TransformResult.success(row) for success    │ plugin-protocol.md:433                   │ ✅ Implemented                        │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-013        │ TransformResult.error(reason) for failure   │ plugin-protocol.md:434                   │ ✅ Implemented                        │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-014        │ Transform on_error config (optional)        │ plugin-protocol.md:350-357               │ ❌ Not implemented                    │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-015        │ TransformErrorEvent recorded on error       │ plugin-protocol.md:464-470               │ ❌ Not implemented                    │
  ├────────────────┼─────────────────────────────────────────────┼──────────────────────────────────────────┼───────────────────────────────────────┤
  │ SDA-016        │ LLM query transform                         │ README.md:103-105                        │ ❌ Not implemented (Phase 6)          │
  └────────────────┴─────────────────────────────────────────────┴──────────────────────────────────────────┴───────────────────────────────────────┘
NOTE: Gate, Fork, Coalesce, Aggregation are now SYSTEM OPERATIONS (see section 4a), NOT transforms.
  3.3 Sinks (from plugin-protocol.md - Plugins touch row contents)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │       Status       │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-017        │ One or more sinks, named                               │ plugin-protocol.md:476       │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-018        │ Sink write(rows: list[dict]) → ArtifactDescriptor      │ plugin-protocol.md:497-510   │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-019        │ ArtifactDescriptor with content_hash (REQUIRED)        │ plugin-protocol.md:556-557   │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-020        │ ArtifactDescriptor with size_bytes (REQUIRED)          │ plugin-protocol.md:557       │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-021        │ Sink idempotent: bool attribute                        │ plugin-protocol.md:609-613   │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-022        │ Idempotency key format: {run_id}:{token_id}:{sink}     │ plugin-protocol.md:613       │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-023        │ CSV sink plugin                                        │ CLAUDE.md                    │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-024        │ JSON sink plugin                                       │ CLAUDE.md                    │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-025        │ Database sink plugin                                   │ CLAUDE.md                    │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-026        │ Webhook sink plugin                                    │ architecture.md:847-849      │ ❌ Not implemented │
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴────────────────────┘
3.4 Source Error Routing (from plugin-protocol.md v1.3)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │       Status       │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-027        │ Source on_validation_failure config (REQUIRED)         │ plugin-protocol.md:222-230   │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-028        │ on_validation_failure: sink name or "discard"          │ plugin-protocol.md:228-229   │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-029        │ QuarantineEvent recorded even for discard              │ plugin-protocol.md:230       │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-030        │ QuarantineEvent: run_id, source_id, row_index          │ plugin-protocol.md:317-322   │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼────────────────────┤
  │ SDA-031        │ QuarantineEvent: raw_row, failure_reason, field_errors │ plugin-protocol.md:318-320   │ ❌ Not implemented │
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴────────────────────┘
  ---

  1. ROUTING REQUIREMENTS
  ┌────────────────┬───────────────────────────────────────────────────────┬─────────────────────────────────────────┬─────────────────────────────┐
  │ Requirement ID │                      Requirement                      │                 Source                  │           Status            │
  ├────────────────┼───────────────────────────────────────────────────────┼─────────────────────────────────────────┼─────────────────────────────┤
  │ RTE-001        │ RoutingKind: CONTINUE, ROUTE_TO_SINK, FORK_TO_PATHS   │ plugin-protocol.md:667-674              │ ✅ Implemented (WP-07/09)   │
  ├────────────────┼───────────────────────────────────────────────────────┼─────────────────────────────────────────┼─────────────────────────────┤
  │ RTE-002        │ Gate routing via config-driven expressions            │ plugin-protocol.md:654-683              │ ✅ Implemented (WP-09)      │
  ├────────────────┼───────────────────────────────────────────────────────┼─────────────────────────────────────────┼─────────────────────────────┤
  │ RTE-003        │ Fork creates child tokens with parent lineage         │ plugin-protocol.md:764-792              │ ✅ Implemented (WP-07)      │
  ├────────────────┼───────────────────────────────────────────────────────┼─────────────────────────────────────────┼─────────────────────────────┤
  │ RTE-004        │ Route resolution map for edge → destination           │ plugin-protocol.md:682-683              │ ✅ Implemented (WP-09)      │
  ├────────────────┼───────────────────────────────────────────────────────┼─────────────────────────────────────────┼─────────────────────────────┤
  │ RTE-005        │ Routing audit: condition, result, route, destination  │ plugin-protocol.md:724-726              │ ✅ Implemented              │
  └────────────────┴───────────────────────────────────────────────────────┴─────────────────────────────────────────┴─────────────────────────────┘

---

  4a. SYSTEM OPERATIONS (Engine-Level, NOT Plugins)

These are config-driven infrastructure provided by the ELSPETH engine.
They operate on wrapped data (tokens, metadata) not row contents.
See plugin-protocol.md lines 623-976 for full specification.

4a.1 Gate (Routing Decision)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬───────────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │          Status           │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-001        │ Gate evaluates condition expression on row data        │ plugin-protocol.md:654-658   │ ✅ Implemented (WP-09)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-002        │ Gate routes map labels to destinations                 │ plugin-protocol.md:668-670   │ ✅ Implemented (WP-09)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-003        │ Gate destinations: continue or sink_name               │ plugin-protocol.md:669-670   │ ✅ Implemented (WP-09)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-004        │ Expression parser uses restricted syntax (NOT eval)    │ plugin-protocol.md:700-719   │ ❌ Not implemented        │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-005        │ Allowed: field access, comparisons, boolean ops        │ plugin-protocol.md:705-710   │ ❌ Not implemented        │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-006        │ NOT allowed: imports, lambdas, arbitrary function calls│ plugin-protocol.md:712-718   │ ❌ Not implemented        │
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴───────────────────────────┘
4a.2 Fork (Token Splitting)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬───────────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │          Status           │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-007        │ Fork creates N child tokens from single parent         │ plugin-protocol.md:731-734   │ ✅ Implemented (WP-07)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-008        │ Child tokens share row_id, have unique token_id        │ plugin-protocol.md:765-766   │ ✅ Implemented (WP-07)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-009        │ Child tokens record parent_token_id                    │ plugin-protocol.md:767       │ ✅ Implemented (WP-07)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-010        │ Parent token terminal state: FORKED                    │ plugin-protocol.md:769       │ ✅ Implemented (WP-07)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-011        │ Fork audit: parent_token_id, child_ids, branches       │ plugin-protocol.md:796-798   │ ✅ Implemented (WP-07)    │
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴───────────────────────────┘
4a.3 Coalesce (Token Merging)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬───────────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │          Status           │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-012        │ Coalesce merges tokens from parallel paths             │ plugin-protocol.md:802-806   │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-013        │ Policy: require_all - wait for all branches            │ plugin-protocol.md:828       │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-014        │ Policy: quorum - wait for N branches                   │ plugin-protocol.md:829       │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-015        │ Policy: best_effort - wait until timeout               │ plugin-protocol.md:830       │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-016        │ Policy: first - take first arrival                     │ plugin-protocol.md:831       │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-017        │ Merge: union, nested, select strategies                │ plugin-protocol.md:835-839   │ 🔄 In progress (WP-08)    │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-018        │ Child tokens terminal state: COALESCED                 │ plugin-protocol.md:847       │ ✅ Model exists           │
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴───────────────────────────┘
4a.4 Aggregation (Token Batching)
  ┌────────────────┬────────────────────────────────────────────────────────┬──────────────────────────────┬───────────────────────────┐
  │ Requirement ID │                       Requirement                      │            Source            │          Status           │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-019        │ Aggregation collects tokens until trigger fires        │ plugin-protocol.md:879-881   │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-020        │ Trigger: count - fire after N tokens                   │ plugin-protocol.md:900       │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-021        │ Trigger: timeout - fire after duration                 │ plugin-protocol.md:901       │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-022        │ Trigger: condition - fire on matching row              │ plugin-protocol.md:902       │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-023        │ Trigger: end_of_source - implicit, always checked      │ plugin-protocol.md:903       │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-024        │ Multiple triggers combinable (first wins)              │ plugin-protocol.md:905       │ ❌ Not implemented (WP-06)│
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-025        │ Input tokens terminal state: CONSUMED_IN_BATCH         │ plugin-protocol.md:924       │ ✅ Model exists           │
  ├────────────────┼────────────────────────────────────────────────────────┼──────────────────────────────┼───────────────────────────┤
  │ SOP-026        │ Batch lifecycle: draft → executing → completed         │ plugin-protocol.md:927       │ ❌ Not implemented (WP-06)│
  └────────────────┴────────────────────────────────────────────────────────┴──────────────────────────────┴───────────────────────────┘

  ---

  1. DAG EXECUTION REQUIREMENTS
  ┌────────────────┬────────────────────────────────────┬────────────────────────────────┬─────────────────────────────────┐
  │ Requirement ID │            Requirement             │             Source             │             Status              │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼─────────────────────────────────┤
  │ DAG-001        │ Pipelines compile to DAG           │ architecture.md:166-184        │ ✅ Implemented (ExecutionGraph) │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼─────────────────────────────────┤
  │ DAG-002        │ DAG validation using NetworkX      │ CLAUDE.md, architecture.md:793 │ ✅ Implemented                  │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼─────────────────────────────────┤
  │ DAG-003        │ Acyclicity check on graph          │ architecture.md:793, CLAUDE.md │ ✅ Implemented                  │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼─────────────────────────────────┤
  │ DAG-004        │ Topological sort for execution     │ architecture.md:793, CLAUDE.md │ ✅ Implemented                  │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼─────────────────────────────────┤
  │ DAG-005        │ Linear pipelines as degenerate DAG │ architecture.md:228-241        │ ✅ Implicit                     │
  └────────────────┴────────────────────────────────────┴────────────────────────────────┴─────────────────────────────────┘

  ---

  1. TOKEN IDENTITY REQUIREMENTS
  ┌────────────────┬────────────────────────────────────────────┬─────────────────────────────────────────┬────────────────────┐
  │ Requirement ID │                Requirement                 │                 Source                  │       Status       │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-001        │ row_id = stable source row identity        │ architecture.md:209, CLAUDE.md          │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-002        │ token_id = row instance in DAG path        │ architecture.md:210, CLAUDE.md          │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-003        │ parent_token_id for fork/join lineage      │ architecture.md:211, CLAUDE.md          │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-004        │ Fork creates child tokens                  │ architecture.md:213-224                 │ ✅ Model exists    │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-005        │ Join/coalesce merges tokens                │ architecture.md:213-224                 │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────┤
  │ TOK-006        │ Token parents table for multi-parent joins │ architecture.md:211, subsystems:152-159 │ ✅ Implemented     │
  └────────────────┴────────────────────────────────────────────┴─────────────────────────────────────────┴────────────────────┘

  ---

  1. LANDSCAPE (AUDIT) REQUIREMENTS

7.1 Core Tables (from subsystems/00-overview:88-253)
  ┌────────────────┬──────────────────────────────────────────┬────────────────────┬────────────────────────┐
  │ Requirement ID │               Requirement                │       Source       │         Status         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-001        │ runs table with all specified columns    │ subsystems:91-101  │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-002        │ runs.reproducibility_grade column        │ subsystems:98      │ ✅ Column exists       │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-003        │ nodes table for execution graph          │ subsystems:103-116 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-004        │ nodes.determinism column                 │ subsystems:110     │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-005        │ nodes.schema_hash column                 │ subsystems:113     │ ✅ Column exists       │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-006        │ edges table for graph connections        │ subsystems:118-128 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-007        │ edges.default_mode column (move/copy)    │ subsystems:126     │ ✅ Implemented as mode │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-008        │ rows table for source rows               │ subsystems:130-140 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-009        │ tokens table for row instances           │ subsystems:142-150 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-010        │ token_parents table for joins            │ subsystems:152-159 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-011        │ node_states table for processing         │ subsystems:161-179 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-012        │ routing_events table for edge selections │ subsystems:181-193 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-013        │ calls table for external calls           │ subsystems:195-210 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-014        │ batches table for aggregations           │ subsystems:212-223 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-015        │ batch_members table                      │ subsystems:225-231 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-016        │ batch_outputs table                      │ subsystems:233-239 │ ✅ Implemented         │
  ├────────────────┼──────────────────────────────────────────┼────────────────────┼────────────────────────┤
  │ LND-017        │ artifacts table for sink outputs         │ subsystems:241-252 │ ✅ Implemented         │
  └────────────────┴──────────────────────────────────────────┴────────────────────┴────────────────────────┘
  7.2 Audit Recording Requirements (from architecture.md, CLAUDE.md)
  ┌────────────────┬──────────────────────────────────────────────┬──────────────────────────┬────────────────────┐
  │ Requirement ID │                 Requirement                  │          Source          │       Status       │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-018        │ Every run with resolved configuration        │ architecture.md:249-250  │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-019        │ Every row loaded from source                 │ architecture.md:252      │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-020        │ Every transform with before/after state      │ architecture.md:253      │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-021        │ Every external call recorded                 │ architecture.md:254      │ ✅ Schema exists   │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-022        │ Every routing decision with reason           │ architecture.md:255      │ ✅ Schema exists   │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-023        │ Every artifact produced                      │ architecture.md:256      │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-024        │ explain() API with complete lineage          │ architecture.md:307-348  │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-025        │ explain() by token_id for DAG precision      │ architecture.md:315, 345 │ ✅ Implemented     │
  ├────────────────┼──────────────────────────────────────────────┼──────────────────────────┼────────────────────┤
  │ LND-026        │ explain() by row_id, sink for disambiguation │ architecture.md:346      │ ❌ Not implemented │
  └────────────────┴──────────────────────────────────────────────┴──────────────────────────┴────────────────────┘
  7.3 Invariants (from architecture.md:267-276)
  ┌────────────────┬────────────────────────────────────────────────────┬─────────────────────┬────────────────────┐
  │ Requirement ID │                    Requirement                     │       Source        │       Status       │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-027        │ Run stores resolved config (not just hash)         │ architecture.md:270 │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-028        │ External calls link to existing spans              │ architecture.md:271 │ ✅ Schema enforces │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-029        │ Strict ordering: transforms by (sequence, attempt) │ architecture.md:272 │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-030        │ No orphan records (foreign keys enforced)          │ architecture.md:273 │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-031        │ (run_id, row_id) unique                            │ architecture.md:274 │ ✅ Implemented     │
  ├────────────────┼────────────────────────────────────────────────────┼─────────────────────┼────────────────────┤
  │ LND-032        │ Canonical JSON contract versioned                  │ architecture.md:275 │ ✅ Implemented     │
  └────────────────┴────────────────────────────────────────────────────┴─────────────────────┴────────────────────┘
  ---

  1. CANONICAL JSON REQUIREMENTS
  ┌────────────────┬───────────────────────────────────────────────┬────────────────────────────────────┬────────────────┐
  │ Requirement ID │                  Requirement                  │               Source               │     Status     │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-001        │ Two-phase canonicalization                    │ architecture.md:358-364, CLAUDE.md │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-002        │ Phase 1: Normalize pandas/numpy to primitives │ architecture.md:384-448            │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-003        │ Phase 2: RFC 8785/JCS serialization           │ architecture.md:450-464            │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-004        │ NaN/Infinity STRICTLY REJECTED                │ architecture.md:394-403, CLAUDE.md │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-005        │ numpy.int64 → Python int                      │ architecture.md:489                │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-006        │ numpy.float64 → Python float                  │ architecture.md:490                │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-007        │ numpy.bool_ → Python bool                     │ architecture.md:491                │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-008        │ pandas.Timestamp → UTC ISO8601                │ architecture.md:492                │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-009        │ NaT, NA → null                                │ architecture.md:493                │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-010        │ Version string sha256-rfc8785-v1              │ architecture.md:380, CLAUDE.md     │ ✅ Implemented │
  ├────────────────┼───────────────────────────────────────────────┼────────────────────────────────────┼────────────────┤
  │ CAN-011        │ Cross-process hash stability test             │ architecture.md:931                │ Need to verify │
  └────────────────┴───────────────────────────────────────────────┴────────────────────────────────────┴────────────────┘

  ---

  1. PAYLOAD STORE REQUIREMENTS
  ┌────────────────┬───────────────────────────────────────────┬─────────────────────────────────────────────┬──────────────────────────────┐
  │ Requirement ID │                Requirement                │                   Source                    │            Status            │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-001        │ PayloadStore protocol with put/get/exists │ architecture.md:524-530, subsystems:675-680 │ ✅ Implemented               │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-002        │ PayloadRef return type                    │ architecture.md:527                         │ ✅ Implemented               │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-003        │ Filesystem backend                        │ subsystems:670                              │ ✅ Implemented               │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-004        │ S3/blob storage backend                   │ subsystems:670                              │ ❌ Not implemented (Phase 7) │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-005        │ Inline backend                            │ subsystems:670                              │ ❌ Not implemented           │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-006        │ Retention policies                        │ architecture.md:539-549, subsystems:685-689 │ ❌ Not implemented (Phase 5) │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-007        │ Hash retained after payload purge         │ architecture.md:546                         │ Architecture allows          │
  ├────────────────┼───────────────────────────────────────────┼─────────────────────────────────────────────┼──────────────────────────────┤
  │ PLD-008        │ Optional compression                      │ subsystems:669                              │ ❌ Not implemented           │
  └────────────────┴───────────────────────────────────────────┴─────────────────────────────────────────────┴──────────────────────────────┘

  ---

  1. FAILURE SEMANTICS REQUIREMENTS
  ┌────────────────┬────────────────────────────────────────────────────────┬─────────────────────────────────────────┬───────────────────────┐
  │ Requirement ID │                      Requirement                       │                 Source                  │        Status         │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-001        │ Token terminal states: COMPLETED                       │ architecture.md:575                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-002        │ Token terminal states: ROUTED                          │ architecture.md:576                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-003        │ Token terminal states: FORKED                          │ architecture.md:577                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-004        │ Token terminal states: CONSUMED_IN_BATCH               │ architecture.md:578                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-005        │ Token terminal states: COALESCED                       │ architecture.md:579                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-006        │ Token terminal states: QUARANTINED                     │ architecture.md:580                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-007        │ Token terminal states: FAILED                          │ architecture.md:581                     │ ✅ Model exists       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-008        │ Terminal states DERIVED, not stored                    │ architecture.md:571-572, subsystems:279 │ ✅ Correct            │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-009        │ Every token reaches exactly one terminal state         │ architecture.md:569, subsystems:281     │ Architecture enforces │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-010        │ TransformResult with status/row/reason/retryable       │ architecture.md:590-598                 │ ✅ Implemented        │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-011        │ Retry: (run_id, row_id, transform_seq, attempt) unique │ architecture.md:603-605, CLAUDE.md      │ ✅ Implemented        │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-012        │ Each retry attempt recorded separately                 │ architecture.md:604                     │ ✅ Implemented        │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-013        │ Backoff metadata captured                              │ architecture.md:606                     │ ✅ RetryManager has   │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼───────────────────────┤
  │ FAI-014        │ At-least-once delivery                                 │ architecture.md:619-621                 │ ✅ By design          │
  └────────────────┴────────────────────────────────────────────────────────┴─────────────────────────────────────────┴───────────────────────┘

  ---

  1. EXTERNAL CALL RECORDING REQUIREMENTS
  ┌────────────────┬─────────────────────────────────────────────┬─────────────────────────┬──────────────────────────────┐
  │ Requirement ID │                 Requirement                 │         Source          │            Status            │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-001        │ Record: provider identifier                 │ architecture.md:695     │ ✅ Schema supports           │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-002        │ Record: model/version                       │ architecture.md:696     │ ✅ Schema supports           │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-003        │ Record: request hash + payload ref          │ architecture.md:697     │ ✅ Schema supports           │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-004        │ Record: response hash + payload ref         │ architecture.md:698     │ ✅ Schema supports           │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-005        │ Record: latency, status code, error details │ architecture.md:699     │ ✅ Schema supports           │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-006        │ Run modes: live, replay, verify             │ architecture.md:655-660 │ ❌ Not implemented (Phase 6) │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-007        │ Verify mode uses DeepDiff                   │ architecture.md:667-687 │ ❌ Not implemented (Phase 6) │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-008        │ Reproducibility grades: FULL_REPRODUCIBLE   │ architecture.md:644     │ ✅ Model exists              │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-009        │ Reproducibility grades: REPLAY_REPRODUCIBLE │ architecture.md:644     │ ✅ Model exists              │
  ├────────────────┼─────────────────────────────────────────────┼─────────────────────────┼──────────────────────────────┤
  │ EXT-010        │ Reproducibility grades: ATTRIBUTABLE_ONLY   │ architecture.md:644     │ ✅ Model exists              │
  └────────────────┴─────────────────────────────────────────────┴─────────────────────────┴──────────────────────────────┘

  ---

  1. DATA GOVERNANCE REQUIREMENTS
  ┌────────────────┬──────────────────────────────────────────────────────┬────────────────────────────────────┬──────────────────────────────┐
  │ Requirement ID │                     Requirement                      │               Source               │            Status            │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-001        │ Secrets NEVER stored - HMAC fingerprint only         │ architecture.md:718-744, CLAUDE.md │ ❌ Not implemented           │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-002        │ secret_fingerprint() function using HMAC             │ architecture.md:729-737            │ ❌ Not implemented           │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-003        │ Fingerprint key loaded from environment              │ architecture.md:746-749            │ ❌ Not implemented           │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-004        │ Configurable redaction profiles                      │ architecture.md:708-711            │ ❌ Not implemented (Phase 5) │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-005        │ Access levels: Operator (redacted)                   │ architecture.md:753-755            │ DEFAULT / NOT REQUIRED       │
  │ GOV-006        │ Access levels: Auditor (full)                        │ architecture.md:756                │ NOT REQUIRED          │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-007        │ Access levels: Admin (retention/purge)               │ architecture.md:757                │ NOT REQUIRED           │
  ├────────────────┼──────────────────────────────────────────────────────┼────────────────────────────────────┼──────────────────────────────┤
  │ GOV-008        │ elspeth explain --full requires ELSPETH_AUDIT_ACCESS │ architecture.md:760-766            │ NOT REQUIRED           │
  └────────────────┴──────────────────────────────────────────────────────┴────────────────────────────────────┴──────────────────────────────┘

  ---

  1. PLUGIN SYSTEM REQUIREMENTS (from plugin-protocol.md v1.3)

NOTE: Gate, Fork, Coalesce, Aggregation are now SYSTEM OPERATIONS (see section 4a), NOT plugins.

13.1 Plugin Architecture
  ┌────────────────┬────────────────────────────────────────────────────────┬─────────────────────────────────────────┬──────────────────────────────────────┐
  │ Requirement ID │                      Requirement                       │                 Source                  │                Status                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-001        │ pluggy hookspecs for Source, Transform, Sink           │ plugin-protocol.md:22-30                │ ✅ Implemented                       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-002        │ Plugins are system code, NOT user-provided extensions  │ plugin-protocol.md:23-24                │ ✅ Policy established                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-003        │ Plugins touch row contents; System Ops touch tokens    │ plugin-protocol.md:26-44                │ ✅ Architecture documented           │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-004        │ BaseSource, BaseTransform, BaseSink base classes       │ plugin-protocol.md:192-620              │ ✅ Implemented                       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-005        │ RowOutcome terminal states model                       │ plugin-protocol.md (via CLAUDE.md)      │ ✅ Implemented                       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-006        │ Plugin determinism declaration (attribute)             │ plugin-protocol.md:1002-1016            │ ✅ Implemented                       │
  └────────────────┴────────────────────────────────────────────────────────┴─────────────────────────────────────────┴──────────────────────────────────────┘
13.2 Three-Tier Trust Model (plugin-protocol.md v1.2)
  ┌────────────────┬────────────────────────────────────────────────────────┬─────────────────────────────────────────┬──────────────────────────────────────┐
  │ Requirement ID │                      Requirement                       │                 Source                  │                Status                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-007        │ External Data (Source input): Zero trust, coercion OK  │ plugin-protocol.md:75                   │ ✅ Policy established                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-008        │ Pipeline Data (Post-source): Elevated trust, no coerce │ plugin-protocol.md:76                   │ ✅ Policy established                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-009        │ Our Code (Plugin internals): Full trust, let crash     │ plugin-protocol.md:77                   │ ✅ Policy established                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-010        │ Type-safe ≠ operation-safe (wrap VALUE operations)     │ plugin-protocol.md:79-91                │ ✅ Policy established                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-011        │ Sources MAY coerce types; Transforms/Sinks MUST NOT    │ plugin-protocol.md:111-119              │ ✅ Policy established                │
  └────────────────┴────────────────────────────────────────────────────────┴─────────────────────────────────────────┴──────────────────────────────────────┘
13.3 Schema Contracts
  ┌────────────────┬────────────────────────────────────────────────────────┬─────────────────────────────────────────┬──────────────────────────────────────┐
  │ Requirement ID │                      Requirement                       │                 Source                  │                Status                │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-012        │ Input/output schema declaration on plugins             │ plugin-protocol.md:200-207, 333-340     │ ✅ Implemented                       │
  ├────────────────┼────────────────────────────────────────────────────────┼─────────────────────────────────────────┼──────────────────────────────────────┤
  │ PLG-013        │ Engine validates schema compatibility at construction  │ plugin-protocol.md:1024-1029            │ ❌ Not implemented                   │
  └────────────────┴────────────────────────────────────────────────────────┴─────────────────────────────────────────┴──────────────────────────────────────┘

  ---

  1. ENGINE REQUIREMENTS
  ┌────────────────┬────────────────────────────────────────────┬─────────────────────────────────────┬──────────────────────────┐
  │ Requirement ID │                Requirement                 │               Source                │          Status          │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-001        │ RowProcessor with span lifecycle           │ architecture.md:950, subsystems:569 │ ✅ Implemented           │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-002        │ Retry with attempt tracking (tenacity)     │ architecture.md:951, CLAUDE.md      │ ✅ Implemented           │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-003        │ Artifact pipeline (topological sort)       │ architecture.md:952                 │ ❌ Not fully implemented │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-004        │ Standard orchestrator                      │ architecture.md:953                 │ ✅ Implemented           │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-005        │ OpenTelemetry span emission                │ architecture.md:954, CLAUDE.md      │ ✅ Implemented           │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-006        │ Aggregation accept/trigger/flush lifecycle │ subsystems:387-391                  │ ❌ Not implemented       │
  ├────────────────┼────────────────────────────────────────────┼─────────────────────────────────────┼──────────────────────────┤
  │ ENG-007        │ Aggregation crash recovery via query       │ subsystems:476-495                  │ ❌ Not implemented       │
  └────────────────┴────────────────────────────────────────────┴─────────────────────────────────────┴──────────────────────────┘

  ---

  1. PRODUCTION HARDENING REQUIREMENTS (Phase 5)
  ┌────────────────┬────────────────────────────────────┬───────────────────────────────────────────────┬────────────────────┐
  │ Requirement ID │            Requirement             │                    Source                     │       Status       │
  ├────────────────┼────────────────────────────────────┼───────────────────────────────────────────────┼────────────────────┤
  │ PRD-001        │ Checkpointing with replay support  │ architecture.md:969, README.md:180            │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────┼───────────────────────────────────────────────┼────────────────────┤
  │ PRD-002        │ Rate limiting using pyrate-limiter │ architecture.md:970, README.md:182, CLAUDE.md │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────┼───────────────────────────────────────────────┼────────────────────┤
  │ PRD-003        │ Retention and purge jobs           │ architecture.md:971                           │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────┼───────────────────────────────────────────────┼────────────────────┤
  │ PRD-004        │ Redaction profiles                 │ architecture.md:972                           │ ❌ Not implemented │
  ├────────────────┼────────────────────────────────────┼───────────────────────────────────────────────┼────────────────────┤
  │ PRD-005        │ Concurrent processing              │ README.md:183                                 │ ❌ NOT IMPLEMENTED │
  └────────────────┴────────────────────────────────────┴───────────────────────────────────────────────┴────────────────────┘

  ---

  1. TECHNOLOGY STACK REQUIREMENTS
  ┌────────────────┬────────────────────────────────────┬────────────────────────────────┬──────────────────────────────┐
  │ Requirement ID │            Requirement             │             Source             │            Status            │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-001        │ CLI: Typer                         │ architecture.md:776, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-002        │ TUI: Textual                       │ architecture.md:777, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-003        │ Configuration: Dynaconf + Pydantic │ architecture.md:778, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-004        │ Plugins: pluggy                    │ architecture.md:779, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-005        │ Data: pandas                       │ architecture.md:780, CLAUDE.md │ ✅ Implied                   │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-006        │ HTTP: httpx                        │ architecture.md:781            │ ❌ Not used yet              │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-007        │ Database: SQLAlchemy Core          │ architecture.md:782, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-008        │ Migrations: Alembic                │ architecture.md:783, CLAUDE.md │ ❌ Not implemented           │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-009        │ Retries: tenacity                  │ architecture.md:784, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-010        │ Canonical JSON: rfc8785            │ architecture.md:792, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-011        │ DAG Validation: NetworkX           │ architecture.md:793, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-012        │ Observability: OpenTelemetry       │ architecture.md:794, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-013        │ Tracing UI: Jaeger                 │ architecture.md:795, CLAUDE.md │ Available but not integrated │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-014        │ Logging: structlog                 │ architecture.md:796, CLAUDE.md │ ✅ Implemented               │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-015        │ Rate Limiting: pyrate-limiter      │ architecture.md:797, CLAUDE.md │ ❌ Not used yet              │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-016        │ Diffing: DeepDiff                  │ architecture.md:798, CLAUDE.md │ ❌ Not used yet              │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-017        │ Property Testing: Hypothesis       │ architecture.md:799, CLAUDE.md │ ❌ Not used yet              │
  ├────────────────┼────────────────────────────────────┼────────────────────────────────┼──────────────────────────────┤
  │ TSK-018        │ LLM: LiteLLM                       │ architecture.md:804, CLAUDE.md │ ❌ Phase 6                   │
  └────────────────┴────────────────────────────────────┴────────────────────────────────┴──────────────────────────────┘

  ---

  1. LANDSCAPE EXPORT REQUIREMENTS
  ┌────────────────┬──────────────────────────────────────────────────┬────────────────┬────────────────┐
  │ Requirement ID │                   Requirement                    │     Source     │     Status     │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-001        │ Export audit trail to configured sink            │ This plan      │ ✅ Implemented │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-002        │ Optional HMAC signing per record                 │ This plan      │ ✅ Implemented │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-003        │ Manifest with final hash for tamper detection    │ This plan      │ ✅ Implemented │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-004        │ CSV and JSON format options                      │ This plan      │ ✅ Implemented │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-005        │ Export happens post-run via config, not CLI      │ This plan      │ ✅ Implemented │
  ├────────────────┼──────────────────────────────────────────────────┼────────────────┼────────────────┤
  │ EXP-006        │ Include all record types (batches, token_parents)│ Code review    │ ✅ Implemented │
  └────────────────┴──────────────────────────────────────────────────┴────────────────┴────────────────┘

  ---
  CRITICAL DIVERGENCES SUMMARY

These are requirements that have been actively diverged from in the implementation:
  ┌────────────┬─────────────────────┬───────────────────────────────────────────────────────────┬──────────────────────────────┐
  │     ID     │        Issue        │                     Architecture Says                     │     Implementation Does      │
  ├────────────┼─────────────────────┼───────────────────────────────────────────────────────────┼──────────────────────────────┤
  │ CFG-001    │ Config key          │ datasource                                                │ source                       │
  ├────────────┼─────────────────────┼───────────────────────────────────────────────────────────┼──────────────────────────────┤
  │ CFG-009    │ Landscape config    │ landscape.enabled, .backend, .path                        │ landscape.url only           │
  ├────────────┼─────────────────────┼───────────────────────────────────────────────────────────┼──────────────────────────────┤
  │ CFG-015    │ Concurrency         │ concurrency.max_workers (4/16)                            │ NOT IMPLEMENTED AT ALL       │
  ├────────────┼─────────────────────┼───────────────────────────────────────────────────────────┼──────────────────────────────┤
  │ PRD-005    │ Parallel processing │ Required per README                                       │ NOT IMPLEMENTED              │
  └────────────┴─────────────────────┴───────────────────────────────────────────────────────────┴──────────────────────────────┘

ALIGNMENT WITH plugin-protocol.md v1.3 (2026-01-17)

This requirements document has been updated to reflect plugin-protocol.md as the authoritative source.

Key Changes:
  ┌─────────────────────────────┬────────────────────────────────────────────────────────────────────────────────┐
  │          Category           │                                    Change                                     │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Plugin vs System Operations │ Gate, Fork, Coalesce, Aggregation are now SYSTEM OPERATIONS (engine-level),   │
  │                             │ NOT plugins. They are config-driven and touch token wrapper, not row contents. │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Section 4a Added            │ New System Operations section documents Gate, Fork, Coalesce, Aggregation     │
  │                             │ as engine-level requirements with WP tracking.                                 │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Error Routing               │ Source on_validation_failure (required), Transform on_error (optional)         │
  │                             │ added to SDA Model section.                                                    │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Sink Contract               │ write(rows: list[dict]) → ArtifactDescriptor with required content_hash and   │
  │                             │ size_bytes fields.                                                             │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Expression Safety           │ Gate conditions must use restricted expression parser (SOP-004 through        │
  │                             │ SOP-006), NOT Python eval().                                                   │
  ├─────────────────────────────┼────────────────────────────────────────────────────────────────────────────────┤
  │ Three-Tier Trust            │ PLG-007 through PLG-011 document coercion rules by plugin type.               │
  └─────────────────────────────┴────────────────────────────────────────────────────────────────────────────────┘

Work Package Status (as of 2026-01-18):
  • WP-01, WP-02, WP-03, WP-04, WP-04a, WP-07, WP-09: ✅ Complete
  • WP-08 (Coalesce Executor): 🔄 In progress
  • WP-05, WP-06, WP-10, WP-11, WP-12, WP-13, WP-14: ❌ Not started

  ---
